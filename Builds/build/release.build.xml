<project name="BIMserver Nightly Build">
	<tstamp>
		<format property="builddate" pattern="yyyy-MM-dd" />
	</tstamp>
	
	<taskdef classname="net.bluecow.googlecode.ant.GoogleCodeUploadTask" classpath="antlibs/ant-googlecode-0.0.3.jar" name="gcupload"/>

	<property name="majorversion" value="1"/>
	<property name="minorversion" value="3"/>
	<property name="revisionversion" value="0"/>
	<property name="type" value="RC4"/>
	<property name="revisiondate" value="${builddate}"/>
	<property name="version" value="${majorversion}.${minorversion}.${revisionversion}-${type}-${revisiondate}"/>

	<target name="release">
		<mkdir dir="/var/www/BIMserver/${majorversion}.${minorversion}"/>
		<mkdir dir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>
		<mkdir dir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}/javadoc"/>
		<copy file="README.txt" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>

		<ant antfile="javadoc.build.xml" target="Build JavaDoc"/>
		<copy file="builds/bimserver-javadoc-${version}.zip" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>

		<copy todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}/javadoc">
			<fileset dir="builds/bimserver-javadoc-${version}"/>
		</copy>
		
		<ant antfile="bimserver.build.xml" target="Build War"/>
		<copy file="builds/bimserver-${version}.war" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>

		<ant antfile="bimserver.build.xml" target="Build Jar"/>
		<copy file="builds/bimserver-${version}.jar" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>
		
		<ant antfile="clientlib.build.xml" target="Build ClientLib"/>
		<copy file="builds/bimserver-client-lib-${version}.zip" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>
		
		<ant antfile="bimserverlib.build.xml" target="Build ServerLib"/>
		<copy file="builds/bimserver-lib-${version}.zip" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>
		
		<ant antfile="source.build.xml" target="Build Source"/>
		<copy file="builds/bimserver-source-${version}.zip" todir="/var/www/BIMserver/${majorversion}.${minorversion}/${version}"/>
		
		<java jar="antlibs/githubrelease.jar">
			<arg>${github_username}</arg>
			<arg>${github_password}</arg>
			<arg>opensourceBIM</arg>
			<arg>BIMserver</arg>
			<arg>test</arg>
			<arg>test</arg>
			<arg>test</arg>
			<arg>true</arg>
			<arg>true</arg>
			<arg>builds/bimserver-${version}.jar;builds/bimserver-${version}.war;builds/bimserver-javadoc-${version}.zip;builds/bimserver-client-lib-${version}.zip;builds/bimserver-lib-${version}.zip</arg>			
		</java>
	</target>
</project>